language: rust

rust:
  - stable

cache: cargo

before_install:
  - sudo apt-get install -y libarchive-dev

before_script:
  - rustup component add clippy
  - rustup component add rustfmt

script:
  - cargo check --verbose --all
  - cargo clippy --all-targets --all-features -- -D warnings
  - cargo fmt --all -- --check
  - git log -1 --pretty=format:'%an'
  - grep --quiet "$(git log -1 --pretty=format:'%an')" Cargo.toml  # check that commit author is mentioned in Cargo.toml

if: tag IS blank  # do not build tags, only commits

sudo: false

notifications:
  email:
    on_success: change
    on_failure: always
